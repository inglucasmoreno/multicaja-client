<!-- Modal: Detalle de movimiento -->
<app-modal-medium [showModal]="showModalDetalles">
    <div class="flex items-center justify-between text-white bg-gray-800 rounded-t p-1">
        <h1 class="px-2"> Detalles de movimiento </h1>
        <svg (click)="showModalDetalles = !showModalDetalles" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x text-white cursor-pointer"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </div>
    <div class="p-2" *ngIf="movimientoSeleccionado">
        <h1 (click)="showDatosMovimiento = !showDatosMovimiento" class="bg-gray-100 flex items-center justify-between text-sm py-1 px-2 text-gray-800 rounded-t border font-semibold hover:bg-yellow-100 cursor-pointer">
            <span> Datos de movimiento  </span>
            <svg *ngIf="!showDatosMovimiento" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
            <svg *ngIf="showDatosMovimiento" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up"><polyline points="18 15 12 9 6 15"></polyline></svg>
        </h1>
        <div *ngIf="showDatosMovimiento" class="border p-2 bg-white text-sm">
            <p class="px-1 lg:py-2"> <span class="font-semibold"> Fecha: </span> <span> {{ this.movimientoSeleccionado.createdAt | fecha }} </span> </p>
            <div class="lg:flex lg:items-center lg:border-t lg:border-b px-1 lg:py-2">
                <p class="lg:w-1/2 py-1 lg:py-0"> <span class="font-semibold"> Tipo de movimiento: </span> <span> {{ this.movimientoSeleccionado.tipo_movimiento.descripcion }} </span> </p>
                <p class="lg:w-1/2 py-1 lg:py-0"> <span class="font-semibold"> Comprobante: </span> <span> {{ this.movimientoSeleccionado.comprobante === '' ? 'SIN ESPECIFICAR' : this.movimientoSeleccionado.comprobante }} </span> </p>
            </div>
            <div class="lg:flex lg:items-center lg:border-b lg:py-2 px-1">
                <p class="lg:w-1/2 lg:py-0 py-1"> <span class="font-semibold"> Centro de costos: </span> <span> {{ this.movimientoSeleccionado.centro_costos.descripcion}} </span> </p>
                <p class="lg:w-1/2 lg:py-0 py-1"> <span class="font-semibold"> Cuenta contable: </span> <span> {{ this.movimientoSeleccionado.cuenta_contable.descripcion}} </span> </p>
            </div>
            <p class="lg:py-2 px-1 py-1"> <span class="font-semibold"> Concepto/Observaci√≥n: </span> <span> {{ this.movimientoSeleccionado.concepto === '' ? 'SIN ESPECIFICAR' : this.movimientoSeleccionado.concepto }} </span> </p>
            <p class="lg:py-2 px-1 py-1 lg:border-t"> <span class="font-semibold"> Monto: </span> <span> ${{ this.movimientoSeleccionado.monto | moneda }} </span> </p>
        </div>
        <div *ngIf="movimientoSeleccionado && movimientoSeleccionado.cheque !== null" class="mt-2 border border-gray-200 rounded-t">
            <h1 (click)="showDatosCheque = !showDatosCheque" class="bg-gray-100 py-1 px-2 text-gray-800 hover:bg-yellow-100 border-b cursor-pointer flex items-center justify-between">
                <span class="font-semibold text-sm"> Datos de cheque </span>
                <svg *ngIf="!showDatosCheque" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
                <svg *ngIf="showDatosCheque" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up"><polyline points="18 15 12 9 6 15"></polyline></svg>
            </h1>
            <div *ngIf="showDatosCheque" class="p-2 text-sm">
                <div class="lg:flex items-center border-b">
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Fecha de emision: </span> <span> {{ this.mostrarCheque.fecha_emision | fecha }} </span> </p>
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Fecha de cobro: </span> <span> {{ this.mostrarCheque.fecha_cobro | fecha }} </span> </p>
                </div>
                <div class="lg:flex items-center border-b">
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Banco: </span> <span> {{ this.mostrarCheque.banco === '' ? 'SIN ESPECIFICAR' : this.mostrarCheque.banco }} </span> </p>
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Numero de cheque: </span> <span> {{ this.mostrarCheque.nro_cheque }} </span> </p>
                </div>
                <div class="lg:flex items-center border-b">
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Emisor: </span> <span> {{ this.mostrarCheque.emisor === '' ? 'SIN ESPECIFICAR' : this.mostrarCheque.emisor }} </span> </p>
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> CUIT (Emisor): </span> <span> {{ this.mostrarCheque.cuit === '' ? 'SIN ESPECIFICAR' : this.mostrarCheque.cuit }} </span> </p>
                </div>
                <div class="lg:flex items-center border-b">
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Cliente: </span> <span> {{ (movimientoSeleccionado.tipo_movimiento._id == tipo_cheque_emitido || movimientoSeleccionado.tipo_movimiento._id == tipo_emitido_cobrado) ? "SIN ESPECIFICAR" : mostrarCheque.cliente_descripcion }} </span>                        </p>
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Destino: </span> <span> {{ this.mostrarCheque.destino_descripcion }} </span> </p>
                </div>
                <p class="p-2 border-b"> <span class="font-semibold"> Concepto: </span> <span> {{ this.mostrarCheque.concepto }} </span> </p>
                <p class="p-2"> <span class="font-semibold"> Importe: </span> <span> ${{ this.mostrarCheque.importe | moneda }} </span> </p>
            </div>
        </div>
        <div class="bg-white lg:flex mt-2">
            <div class="lg:w-1/2 w-full h-full text-sm">
                <p class="font-semibold bg-orange-700 text-white py-1 px-2 rounded text-center"> Datos de origen </p>
                <div class="p-1">
                    <p class="p-1"> <span class="font-semibold"> Origen: </span> <span class="text-sm"> {{ this.movimientoSeleccionado.origen_descripcion }} </span> </p>
                    <p class="p-1"> <span class="font-semibold"> Saldo impactado: </span> <span class="text-sm"> {{ this.movimientoSeleccionado.tipo_origen === 'Interno' ? this.movimientoSeleccionado.origen_saldo_descripcion : 'Externo'}} </span> </p>
                    <p class="p-1"> <span class="font-semibold"> Saldo anterior: </span> <span [ngClass]="{ 'text-red-500' : this.movimientoSeleccionado.origen_monto_anterior < 0}" class="text-sm"> {{ this.movimientoSeleccionado.tipo_origen === 'Interno' ? ('$' + (this.movimientoSeleccionado.origen_monto_anterior | moneda)) : 'Externo' }} </span>                        </p>
                    <p class="p-1"> <span class="font-semibold"> Nuevo saldo: </span> <span [ngClass]="{ 'text-red-500' : this.movimientoSeleccionado.origen_monto_nuevo < 0}" class="text-sm"> {{ this.movimientoSeleccionado.tipo_origen === 'Interno' ? ('$' + (this.movimientoSeleccionado.origen_monto_nuevo | moneda)) : 'Externo' }} </span>                        </p>
                </div>
            </div>
            <div class="lg:w-1/2 w-full h-full ml-1 text-sm">
                <p class="font-semibold bg-green-700 text-white py-1 px-2 rounded text-center"> Datos de destino </p>
                <div class="p-1">
                    <p class="p-1"> <span class="font-semibold"> Destino: </span> <span class="text-sm"> {{ this.movimientoSeleccionado.destino_descripcion }} </span> </p>
                    <p class="p-1"> <span class="font-semibold"> Saldo impactado: </span> <span class="text-sm"> {{ this.movimientoSeleccionado.tipo_destino === 'Interno' ? this.movimientoSeleccionado.destino_saldo_descripcion : 'Externo'}} </span> </p>
                    <p class="p-1"> <span class="font-semibold"> Saldo anterior: </span> <span [ngClass]="{ 'text-red-500' : this.movimientoSeleccionado.destino_monto_anterior < 0}" class="text-sm"> {{ this.movimientoSeleccionado.tipo_destino === 'Interno' ? ('$' + (this.movimientoSeleccionado.destino_monto_anterior | moneda)) : 'Externo' }} </span>                        </p>
                    <p class="p-1"> <span class="font-semibold"> Nuevo saldo: </span> <span [ngClass]="{ 'text-red-500' : this.movimientoSeleccionado.destino_monto_nuevo < 0}" class="text-sm"> {{ this.movimientoSeleccionado.tipo_destino === 'Interno' ? ('$' + (this.movimientoSeleccionado.destino_monto_nuevo | moneda)) : 'Externo' }} </span>                        </p>
                </div>
            </div>
        </div>
    </div>
</app-modal-medium>

<div class="p-2 lg:flex">
    <div class="w-full lg:w-1/2 p-2 bg-white border shadow h-full">
        <h1 class="font-semibold p-2 border bg-gray-100 text-center border-gray-200"> Filtrado de movimientos </h1>
        <div class="mt-4">
            <div class="flex items-center text-sm">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                <label class="font-semibold ml-1"> Desde <span class="font-normal"> (Fecha de movimiento) </span> </label>
            </div>
            <div class="w-full">
                <div class="bg-white my-2 flex">
                    <input [(ngModel)]="filtroMovimientos.desde" type="date" class="border rounded p-1 py-2 w-full shadow text-sm focus:outline-none">
                </div>
            </div>
            <div class="flex items-center text-sm mt-4">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                <label class="font-semibold ml-1"> Hasta <span class="font-normal"> (Fecha de movimiento) </span> </label>
            </div>
            <div class="w-full">
                <div class="bg-white my-2 flex">
                    <input [(ngModel)]="filtroMovimientos.hasta" type="date" class="border bg-white rounded p-1 py-2 w-full shadow text-sm focus:outline-none">
                </div>
            </div>
            <div class="bg-white my-3">
                <p class="text-sm font-semibold"> Tipo de movimiento </p>
                <select [(ngModel)]="filtroMovimientos.tipo_movimiento" name="tipo_movimiento" class="border bg-white rounded p-1 py-2 w-full shadow text-sm mt-2">
                    <option value=''> Todos los tipos </option>
                    <option *ngFor="let tipo of tipoMovimientos" [value]='tipo._id'> {{ tipo.descripcion }} </option>
                </select>
            </div>
            <div class="bg-white my-3">
                <p class="text-sm font-semibold"> Tipo de origen </p>
                <select (change)="cambiarOrigen()" [(ngModel)]="filtroMovimientos.tipo_origen" name="tipo_origen" class="border bg-white rounded p-1 py-2 w-full shadow text-sm mt-2">
                    <option value=''>  Todos los origenes </option>
                    <option value='Interno'> Interno </option>
                    <option value='Externo'> Externo </option>
                </select>
            </div>
            <div *ngIf="filtroMovimientos.tipo_origen !== ''" class="bg-white my-3">
                <p class="text-sm font-semibold"> Origen </p>
                <select [(ngModel)]="filtroMovimientos.origen" name="origen" class="border bg-white rounded p-1 py-2 w-full shadow text-sm mt-2">
                    <option value=''> {{ filtroMovimientos.tipo_origen === 'Interno' ? 'Todos los internos' : 'Todos los externos' }} </option>
                    <option *ngFor="let origen of origenes" [value]="origen._id"> {{ origen.descripcion ? origen.descripcion : origen.razon_social }} </option>
                </select>
            </div>
            <div class="bg-white my-3">
                <p class="text-sm font-semibold"> Tipo de destino </p>
                <select (change)="cambiarDestino()" [(ngModel)]="filtroMovimientos.tipo_destino" name="tipo_destino" class="border bg-white rounded p-1 py-2 w-full shadow text-sm mt-2">
                    <option value=''> Todos los destinos </option>
                    <option value='Interno'> Interno </option>
                    <option value='Externo'> Externo </option>
                </select>
            </div>
            <div *ngIf="filtroMovimientos.tipo_destino !== ''" class="bg-white my-3">
                <p class="text-sm font-semibold"> Destino </p>
                <select [(ngModel)]="filtroMovimientos.destino" name="destino" class="border bg-white rounded p-1 py-2 w-full shadow text-sm mt-2">
                    <option value=''> {{ filtroMovimientos.tipo_destino === 'Interno' ? 'Todos los internos' : 'Todos los externos' }} </option>
                    <option *ngFor="let destino of destinos" [value]="destino._id"> {{ destino.descripcion ? destino.descripcion : destino.razon_social }} </option>
                </select>
            </div>
            <div class="flex items-center mt-6">
                <button (click)="buscar()" class="flex items-center focus:outline-none justify-center bg-gray-100 border border-gray-200 rounded p-2 w-1/2 hover:text-green-700">  
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>    
                    <span class="ml-1"> Buscar </span>
                </button>
                <button routerLink="/dashboard/reportes" class="flex items-center focus:outline-none justify-center bg-gray-100 border border-gray-200 rounded p-2 w-1/2 text-center ml-2 hover:text-green-700">  
                    <span> Regresar </span>
                </button>
            </div>
        </div>
    </div>
    <div class="w-full p-2 bg-white border shadow lg:ml-2 mt-2 lg:mt-0 h-full">
        <!-- No se encontraron resulados -->
        <div *ngIf="movimientos.length === 0">
            <p class="font-semibold text-gray-500 text-xl text-center p-4">
                No se encontraron resultados
            </p>
        </div>
        <!-- Resultados encontrados -->
        <div *ngIf="movimientos.length !== 0" class="border bg-white rounder">
            <div class="pt-5 pb-1 border-b">
                <pagination-controls class="text-sm text-center" nextLabel="Siguiente" previousLabel="Anterior" (pageChange)="paginaActual = $event"></pagination-controls>
            </div>
            <div class="bg-gray-100 text-lg font-semibold p-2 flex items-center justify-between border-b text-gray-600">
                <span class="ml-2">
                    Total de resultados: {{ movimientos.length }}
                </span>
                <span (click)="ordenarFecha()" title="ordenar por fechas" class="p-1 rounded bg-white border border-gray-300 hover:bg-yellow-100 cursor-pointer">
                    <svg *ngIf="ordenar.direccion === -1" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                    <svg *ngIf="ordenar.direccion === 1" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                </span>
            </div>
            <div (click)="modalDetalles(movimiento)" [ngClass]="{'border-yellow-500 hover:bg-yellow-100' : movimiento.cheque !== null }" class="border border-green-600 hover:bg-green-100 shadow p-2 m-2 cursor-pointer rounded border-l-8 text-sm" *ngFor="let movimiento of movimientos | paginate: {itemsPerPage: cantidadItems, currentPage: paginaActual}">
                <div class="px-1 py-2 lg:flex lg:items-center pb-2">
                    <p> <span class="font-semibold"> Fecha de movimiento: </span> {{ movimiento.createdAt | fecha }} </p>
                </div>
                <p class="px-1 py-3 border-t"> <span class="font-semibold"> Tipo de movimiento: </span> {{ movimiento.tipo_movimiento.descripcion }} </p>
                <div class="border-t border-b pb-2 lg:flex lg:items-center pt-2">
                    <p class="p-1"> <span class="font-semibold"> Origen: </span> {{ movimiento.origen_descripcion }} </p>
                    <p *ngIf="movimiento.tipo_origen === 'Interno'" class="p-1 text-xs">
                        <span class="bg-orange-100 py-1 px-2 rounded border flex items-center border-orange-200"> 
                            {{ movimiento.origen_saldo_descripcion }} - ${{ movimiento.origen_monto_anterior | moneda }}
                                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right ml-1 mr-1"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>           
                            ${{ movimiento.origen_monto_nuevo | moneda }}
                        </span>
                    </p>
                    <p *ngIf="movimiento.tipo_origen === 'Externo'" class="p-1 text-xs">
                        <span class="bg-orange-100 py-1 px-2 rounded border flex items-center border-orange-200"> 
                            EXTERNO
                        </span>
                    </p>
                </div>
                <div class="border-t border-b lg:flex lg:items-center pb-2 pt-2">
                    <p class="p-1"> <span class="font-semibold"> Destino: </span> {{ movimiento.destino_descripcion }} </p>
                    <p *ngIf="movimiento.tipo_destino === 'Interno'" class="p-1 text-xs">
                        <span class="bg-green-100 py-1 px-2 flex items-center rounded border border-green-200"> 
                            {{ movimiento.destino_saldo_descripcion }} - ${{ movimiento.destino_monto_anterior | moneda }}
                                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right ml-1 mr-1"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                            ${{ movimiento.destino_monto_nuevo | moneda }}
                        </span>
                    </p>
                    <p *ngIf="movimiento.tipo_destino === 'Externo'" class="p-1 text-xs">
                        <span class="bg-green-100 py-1 px-2 flex items-center rounded border border-green-200"> 
                            EXTERNO
                        </span>
                    </p>
                </div>
                <p class="p-2 font-semibold"> Monto: ${{ movimiento.monto | moneda }} </p>
            </div>
        </div>
    </div>
</div>