<!-- Modal: Detalle de movimiento -->
<app-modal-medium [showModal]="showModalDetalles">
    <div class="flex items-center justify-between text-white bg-gray-800 rounded-t p-1">
        <h1 class="px-2"> Detalles de movimiento </h1>
        <svg (click)="showModalDetalles = !showModalDetalles" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x text-white cursor-pointer"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </div>
    <div class="p-2" *ngIf="movimientoSeleccionado">
        <h1 (click)="showDatosMovimiento = !showDatosMovimiento" class="bg-gray-100 flex items-center justify-between text-sm py-1 px-2 text-gray-800 rounded-t border font-semibold hover:bg-yellow-100 cursor-pointer">
            <span> Datos de movimiento  </span>
            <svg *ngIf="!showDatosMovimiento" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
            <svg *ngIf="showDatosMovimiento" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up"><polyline points="18 15 12 9 6 15"></polyline></svg>
        </h1>
        <div *ngIf="showDatosMovimiento" class="border p-2 bg-white text-sm">
            <p class="px-1 lg:py-2"> <span class="font-semibold"> Fecha: </span> <span> {{ this.movimientoSeleccionado.createdAt | fecha }} </span> </p>
            <div class="lg:flex lg:items-center lg:border-t lg:border-b px-1 lg:py-2">
                <p class="lg:w-1/2 py-1 lg:py-0"> <span class="font-semibold"> Tipo de movimiento: </span> <span> {{ this.movimientoSeleccionado.tipo_movimiento.descripcion }} </span> </p>
                <p class="lg:w-1/2 py-1 lg:py-0"> <span class="font-semibold"> Comprobante: </span> <span> {{ this.movimientoSeleccionado.comprobante === '' ? 'SIN ESPECIFICAR' : this.movimientoSeleccionado.comprobante }} </span> </p>
            </div>
            <div class="lg:flex lg:items-center lg:border-b lg:py-2 px-1">
                <p class="lg:w-1/2 lg:py-0 py-1"> <span class="font-semibold"> Centro de costos: </span> <span> {{ this.movimientoSeleccionado.centro_costos.descripcion}} </span> </p>
                <p class="lg:w-1/2 lg:py-0 py-1"> <span class="font-semibold"> Cuenta contable: </span> <span> {{ this.movimientoSeleccionado.cuenta_contable.descripcion}} </span> </p>
            </div>
            <p class="lg:py-2 px-1 py-1"> <span class="font-semibold"> Concepto/Observación: </span> <span> {{ this.movimientoSeleccionado.concepto === '' ? 'SIN ESPECIFICAR' : this.movimientoSeleccionado.concepto }} </span> </p>
            <p class="lg:py-2 px-1 py-1 lg:border-t"> <span class="font-semibold"> Monto: </span> <span> ${{ this.movimientoSeleccionado.monto | moneda }} </span> </p>
        </div>
        <div *ngIf="movimientoSeleccionado && movimientoSeleccionado.cheque !== null" class="mt-2 border border-gray-200 rounded-t">
            <h1 (click)="showDatosCheque = !showDatosCheque" class="bg-gray-100 py-1 px-2 text-gray-800 hover:bg-yellow-100 border-b cursor-pointer flex items-center justify-between">
                <span class="font-semibold text-sm"> Datos de cheque </span>
                <svg *ngIf="!showDatosCheque" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
                <svg *ngIf="showDatosCheque" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-up"><polyline points="18 15 12 9 6 15"></polyline></svg>
            </h1>
            <div *ngIf="showDatosCheque" class="p-2 text-sm">
                <div class="lg:flex items-center border-b">
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Fecha de emision: </span> <span> {{ this.chequeSeleccionado.fecha_emision | fecha }} </span> </p>
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Fecha de cobro: </span> <span> {{ this.chequeSeleccionado.fecha_cobro | fecha }} </span> </p>
                </div>
                <div class="lg:flex items-center border-b">
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Banco: </span> <span> {{ this.chequeSeleccionado.banco === '' ? 'SIN ESPECIFICAR' : this.chequeSeleccionado.banco }} </span> </p>
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Numero de cheque: </span> <span> {{ this.chequeSeleccionado.nro_cheque }} </span> </p>
                </div>
                <div class="lg:flex items-center border-b">
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Emisor: </span> <span> {{ this.chequeSeleccionado.emisor === '' ? 'SIN ESPECIFICAR' : this.chequeSeleccionado.emisor }} </span> </p>
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> CUIT (Emisor): </span> <span> {{ this.chequeSeleccionado.cuit === '' ? 'SIN ESPECIFICAR' : this.chequeSeleccionado.cuit }} </span> </p>
                </div>
                <div class="lg:flex items-center border-b">
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Cliente: </span> <span> {{ this.chequeSeleccionado.cliente_descripcion }} </span> </p>
                    <p class="p-2 lg:w-1/2"> <span class="font-semibold"> Destino: </span> <span> {{ this.chequeSeleccionado.destino_descripcion }} </span> </p>
                </div>
                <p class="p-2 border-b"> <span class="font-semibold"> Concepto: </span> <span> {{ this.chequeSeleccionado.concepto }} </span> </p>
                <p class="p-2"> <span class="font-semibold"> Importe: </span> <span> ${{ this.chequeSeleccionado.importe | moneda }} </span> </p>
            </div>
        </div>
        <div class="bg-white lg:flex mt-2">
            <div class="lg:w-1/2 w-full h-full text-sm">
                <p class="font-semibold bg-orange-700 text-white py-1 px-2 rounded text-center"> Datos de origen </p>
                <div class="p-1">
                    <p class="p-1"> <span class="font-semibold"> Origen: </span> <span class="text-sm"> {{ this.movimientoSeleccionado.origen_descripcion }} </span> </p>
                    <p class="p-1"> <span class="font-semibold"> Saldo impactado: </span> <span class="text-sm"> {{ this.movimientoSeleccionado.tipo_origen === 'Interno' ? this.movimientoSeleccionado.origen_saldo_descripcion : 'Externo'}} </span> </p>
                    <p class="p-1"> <span class="font-semibold"> Saldo anterior: </span> <span [ngClass]="{ 'text-red-500' : this.movimientoSeleccionado.origen_monto_anterior < 0}" class="text-sm"> {{ this.movimientoSeleccionado.tipo_origen === 'Interno' ? ('$' + (this.movimientoSeleccionado.origen_monto_anterior | moneda)) : 'Externo' }} </span>                        </p>
                    <p class="p-1"> <span class="font-semibold"> Nuevo saldo: </span> <span [ngClass]="{ 'text-red-500' : this.movimientoSeleccionado.origen_monto_nuevo < 0}" class="text-sm"> {{ this.movimientoSeleccionado.tipo_origen === 'Interno' ? ('$' + (this.movimientoSeleccionado.origen_monto_nuevo | moneda)) : 'Externo' }} </span>                        </p>
                </div>
            </div>
            <div class="lg:w-1/2 w-full h-full ml-1 text-sm">
                <p class="font-semibold bg-green-700 text-white py-1 px-2 rounded text-center"> Datos de destino </p>
                <div class="p-1">
                    <p class="p-1"> <span class="font-semibold"> Destino: </span> <span class="text-sm"> {{ this.movimientoSeleccionado.destino_descripcion }} </span> </p>
                    <p class="p-1"> <span class="font-semibold"> Saldo impactado: </span> <span class="text-sm"> {{ this.movimientoSeleccionado.tipo_destino === 'Interno' ? this.movimientoSeleccionado.destino_saldo_descripcion : 'Externo'}} </span> </p>
                    <p class="p-1"> <span class="font-semibold"> Saldo anterior: </span> <span [ngClass]="{ 'text-red-500' : this.movimientoSeleccionado.destino_monto_anterior < 0}" class="text-sm"> {{ this.movimientoSeleccionado.tipo_destino === 'Interno' ? ('$' + (this.movimientoSeleccionado.destino_monto_anterior | moneda)) : 'Externo' }} </span>                        </p>
                    <p class="p-1"> <span class="font-semibold"> Nuevo saldo: </span> <span [ngClass]="{ 'text-red-500' : this.movimientoSeleccionado.destino_monto_nuevo < 0}" class="text-sm"> {{ this.movimientoSeleccionado.tipo_destino === 'Interno' ? ('$' + (this.movimientoSeleccionado.destino_monto_nuevo | moneda)) : 'Externo' }} </span>                        </p>
                </div>
            </div>
        </div>
    </div>
</app-modal-medium>
<div class="p-2 lg:flex">
    <div class="w-full lg:w-1/2 p-2 bg-white border shadow h-full">
        <h1 class="font-semibold p-2 border bg-gray-100 text-center border-gray-200"> Filtrado de evolución de saldos </h1>
        <div class="mt-4">

            <div class="flex items-center text-sm">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                <label class="font-semibold ml-1"> Desde </label>
            </div>

            <div class="w-full">
                <div class="bg-white my-2 flex">
                    <input [(ngModel)]="filtroSaldos.fechaDesde" type="date" class="border rounded p-1 py-2 w-full shadow text-sm focus:outline-none">
                </div>
            </div>

            <div class="flex items-center text-sm mt-4">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                <label class="font-semibold ml-1"> Hasta </label>
            </div>

            <div class="w-full">
                <div class="bg-white my-2 flex">
                    <input [(ngModel)]="filtroSaldos.fechaHasta" type="date" class="border rounded p-1 py-2 w-full shadow text-sm focus:outline-none">
                </div>
            </div>

            <div class="bg-white my-3">
                <p class="text-sm font-semibold"> Empresa </p>
                <select (change)="cambiarEmpresa()" [(ngModel)]="filtroSaldos.empresa" name="emisor" class="border rounded p-1 py-2 w-full shadow text-sm mt-2">
                    <option value=''> Debe elegir una empresa </option>
                    <option *ngFor="let empresa of empresas" [value]="empresa._id"> {{ empresa.razon_social }} </option>
                </select>
            </div>

            <div *ngIf="filtroSaldos.empresa !== ''" class="bg-white my-3">
                <p class="text-sm font-semibold"> Saldos </p>
                <select [(ngModel)]="filtroSaldos.saldo" name="tipo_destino" class="border rounded p-1 py-2 w-full shadow text-sm mt-2">
                    <option value=''> Debe elegir un saldo </option>
                    <option *ngFor="let saldo of saldos" [value]='saldo._id'> {{ saldo.descripcion }} </option>
                </select>
            </div>

            <div class="flex items-center mt-6">
                <button (click)="buscar()" class="flex items-center focus:outline-none justify-center bg-gray-100 border border-gray-200 rounded p-2 w-1/2 hover:text-green-700">  
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>    
                    <span class="ml-1"> Buscar </span>
                </button>
                <button routerLink="/dashboard/reportes" class="flex items-center focus:outline-none justify-center bg-gray-100 border border-gray-200 rounded p-2 w-1/2 text-center ml-2 hover:text-green-700">  
                    <span> Regresar </span>
                </button>
            </div>

        </div>
    </div>
    <div class="w-full p-2 bg-white border shadow lg:ml-2 mt-2 lg:mt-0 h-full">
        <!-- No se encontraron resulados -->
        <div *ngIf="evoluciones.length === 0">
            <p class="font-semibold text-gray-500 text-xl text-center p-4">
                No se encontraron resultados
            </p>
        </div>
        <div class="border" *ngIf="evoluciones.length !== 0">
            <div class="pt-5 pb-1 border-b">
                <pagination-controls class="text-sm text-center" nextLabel="Siguiente" previousLabel="Anterior" (pageChange)="paginaActual = $event"></pagination-controls>
            </div>
            <div class="bg-gray-100 text-lg font-semibold p-2 flex items-center justify-between border-b text-gray-600">
                <span class="ml-2">
                    Total de resultados: {{ evoluciones.length }}
                </span>
                <span (click)="ordenarFecha()" title="ordenar por fechas" class="p-1 rounded bg-white border border-gray-300 hover:bg-yellow-100 cursor-pointer">
                    <svg *ngIf="ordenar.direccion === -1" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                    <svg *ngIf="ordenar.direccion === 1" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                </span>
            </div>
            <div (click)="detalleMovimiento(evolucion)" [ngClass]="{'border-red-600 hover:bg-red-100' : (evolucion.monto_actual < evolucion.monto_anterior)}" class="border hover:bg-green-100 cursor-pointer border-l-8 flex items-center justify-between border-green-600 rounded p-2 m-2"
                *ngFor="let evolucion of evoluciones | paginate: {itemsPerPage: cantidadItems, currentPage: paginaActual}">
                <div>
                    <p class="flex items-center">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        <span class="ml-1">
                            Fecha: {{ evolucion.createdAt | fecha }} 
                        </span>
                    </p>
                    <p [ngClass]="{'text-red-700' : (evolucion.monto_actual < evolucion.monto_anterior)}" class="text-green-700 py-1 flex items-center font-semibold mt-2">
                        <svg *ngIf="evolucion.monto_actual >= evolucion.monto_anterior" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up text-white rounded-full bg-green-700"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
                        <svg *ngIf="evolucion.monto_actual < evolucion.monto_anterior" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-down text-white rounded-full bg-red-700"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                        <span class="mr-1 ml-2"> ${{ evolucion.monto_anterior | moneda }}  </span>
                        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                        <span class="ml-1"> ${{ evolucion.monto_actual | moneda }}  </span>
                    </p>
                </div>
                <div>
                    <p class="font-semibold lg:text-lg"> ${{ evolucion.monto_actual | moneda }} </p>
                </div>
            </div>
        </div>
    </div>
</div>